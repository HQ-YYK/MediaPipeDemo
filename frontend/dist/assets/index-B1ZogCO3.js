const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./OrbitControls-QnqJmqe9.js","./three-Dy6-mv4g.js"])))=>i.map(i=>d[i]);
import{r as i,a as B,R as G}from"./vendor-nf7bT_Uh.js";import{P as T,H as F}from"./mediapipe-D662JjxJ.js";import{S as H,C as q,P as K,W as U,A as W,D as I,a as J,G as Y,b as Q,M as X,c as Z,V as D,B as ee,L as te,d as se}from"./three-Dy6-mv4g.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))d(t);new MutationObserver(t=>{for(const l of t)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&d(a)}).observe(document,{childList:!0,subtree:!0});function f(t){const l={};return t.integrity&&(l.integrity=t.integrity),t.referrerPolicy&&(l.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?l.credentials="include":t.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(t){if(t.ep)return;t.ep=!0;const l=f(t);fetch(t.href,l)}})();var $={exports:{}},O={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var re=i,ne=Symbol.for("react.element"),ae=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,oe=re.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,le={key:!0,ref:!0,__self:!0,__source:!0};function V(p,o,f){var d,t={},l=null,a=null;f!==void 0&&(l=""+f),o.key!==void 0&&(l=""+o.key),o.ref!==void 0&&(a=o.ref);for(d in o)ie.call(o,d)&&!le.hasOwnProperty(d)&&(t[d]=o[d]);if(p&&p.defaultProps)for(d in o=p.defaultProps,o)t[d]===void 0&&(t[d]=o[d]);return{$$typeof:ne,type:p,key:l,ref:a,props:t,_owner:oe.current}}O.Fragment=ae;O.jsx=V;O.jsxs=V;$.exports=O;var n=$.exports,A={},z=B;A.createRoot=z.createRoot,A.hydrateRoot=z.hydrateRoot;let L=null,M=!1;const ce=async()=>{if(!(L||M)){M=!0;try{console.log("预加载 MediaPipe 模型...");const p=await T.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.9/wasm");L=await F.createFromOptions(p,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",delegate:"GPU"},runningMode:"VIDEO",numPoses:1}),console.log("MediaPipe 模型预加载完成 (仅姿态)")}catch(p){console.error("模型预加载失败:",p)}finally{M=!1}}};ce();const ue=({onPoseDetection:p,onReady:o,onStarted:f,onStopped:d})=>{const t=i.useRef(null),l=i.useRef(null),a=i.useRef(null),u=i.useRef(null),R=i.useRef(null),h=i.useRef(0),[P,j]=i.useState(!1),[m,c]=i.useState(null),[r,e]=i.useState("准备中..."),s=[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[12,14],[14,16],[15,17],[15,19],[15,21],[17,19],[16,18],[16,20],[18,20],[23,24],[23,25],[25,27],[27,29],[27,31],[24,26],[26,28],[28,30],[28,32]],w=async()=>{try{e("正在启动相机...");const[v,y]=await Promise.all([(async()=>{if(L)return e("模型已就绪，正在启动相机..."),L;for(e("正在加载 MediaPipe 模型...");M;)await new Promise(x=>setTimeout(x,100));if(L)return L;e("重新加载模型...");const E=await T.forVisionTasks("/mediapipe/wasm");return await F.createFromOptions(E,{baseOptions:{modelAssetPath:"/models/pose_landmarker_lite.task",delegate:"GPU"},runningMode:"VIDEO",numPoses:1})})(),navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user",frameRate:{ideal:30,max:30}}})]);a.current=v,u.current=y,e("正在连接视频流..."),t.current&&(t.current.srcObject=y,t.current.onloadedmetadata=()=>{e("正在启动姿态检测..."),g(),j(!0),e("✅ 已连接"),typeof o=="function"&&o(),typeof f=="function"&&f()}),console.log("MediaPipe 和相机快速初始化成功")}catch(v){console.error("初始化失败:",v),c("初始化失败: "+(v instanceof Error?v.message:"未知错误"))}},b=()=>{R.current&&(cancelAnimationFrame(R.current),R.current=null),u.current&&(u.current.getTracks().forEach(v=>v.stop()),u.current=null),t.current&&(t.current.srcObject=null),j(!1),e("已停止"),typeof d=="function"&&d()},g=()=>{const v=async()=>{if(a.current&&t.current&&t.current.readyState===4){const y=performance.now();if(y-h.current>=33){h.current=y;const x=a.current.detectForVideo(t.current,y);if(x.landmarks&&x.landmarks.length>0){const N={success:!0,landmarks:x.landmarks[0].map((S,_)=>({id:_,x:S.x,y:S.y,z:S.z,visibility:S.visibility||1})),connections:s};p(N)}}}R.current=requestAnimationFrame(v)};v()};return i.useEffect(()=>(w(),()=>{b(),a.current&&a.current!==L&&a.current.close()}),[]),m?n.jsx("div",{className:"camera-capture error",children:n.jsxs("div",{className:"error-message",children:[n.jsx("h3",{children:"❌ 错误"}),n.jsx("p",{children:m}),n.jsx("button",{onClick:()=>window.location.reload(),children:"刷新页面重试"})]})}):n.jsxs("div",{className:"camera-capture",children:[n.jsxs("div",{className:"camera-header",children:[n.jsx("h3",{children:"📷 相机捕获"}),n.jsx("div",{className:"status",children:P?"✅ 已连接":r}),n.jsx("button",{onClick:()=>P?b():w(),className:"camera-toggle-btn",children:P?"停止相机":"启动相机"})]}),n.jsxs("div",{className:"camera-container",children:[n.jsx("video",{ref:t,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-video"}),n.jsx("canvas",{ref:l,className:"camera-canvas",width:640,height:480}),!P&&r!=="已停止"&&n.jsxs("div",{className:"loading-overlay",children:[n.jsx("div",{className:"loading-spinner"}),n.jsx("p",{children:r})]})]})]})},de="modulepreload",fe=function(p,o){return new URL(p,o).href},C={},me=function(o,f,d){let t=Promise.resolve();if(f&&f.length>0){const a=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),R=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));t=Promise.allSettled(f.map(h=>{if(h=fe(h,d),h in C)return;C[h]=!0;const P=h.endsWith(".css"),j=P?'[rel="stylesheet"]':"";if(!!d)for(let r=a.length-1;r>=0;r--){const e=a[r];if(e.href===h&&(!P||e.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${h}"]${j}`))return;const c=document.createElement("link");if(c.rel=P?"stylesheet":de,P||(c.as="script"),c.crossOrigin="",c.href=h,R&&c.setAttribute("nonce",R),document.head.appendChild(c),P)return new Promise((r,e)=>{c.addEventListener("load",r),c.addEventListener("error",()=>e(new Error(`Unable to preload CSS for ${h}`)))})}))}function l(a){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=a,window.dispatchEvent(u),!u.defaultPrevented)throw a}return t.then(a=>{for(const u of a||[])u.status==="rejected"&&l(u.reason);return o().catch(l)})},pe=({poseData:p,onReady:o})=>{const f=i.useRef(null),d=i.useRef(null),t=i.useRef(null),l=i.useRef(null),a=i.useRef(null),u=i.useRef([]),R=i.useRef([]),h=i.useRef(null),P=i.useRef(null),j=i.useRef(null);return i.useEffect(()=>{if(!f.current)return;const m=f.current,c=new H;c.background=new q(2763306),d.current=c;const r=new K(60,m.clientWidth/m.clientHeight,.1,1e3);r.position.set(0,0,5),t.current=r;const e=new U({antialias:!1,alpha:!0,powerPreference:"high-performance"});e.setSize(m.clientWidth,m.clientHeight),e.shadowMap.enabled=!1,e.setPixelRatio(Math.min(window.devicePixelRatio,1.2)),l.current=e;let s;(async()=>{const S=(await me(()=>import("./OrbitControls-QnqJmqe9.js"),__vite__mapDeps([0,1]),import.meta.url)).OrbitControls;s=new S(r,e.domElement),s.enableDamping=!0,s.dampingFactor=.05,s.screenSpacePanning=!1,s.minDistance=4,s.maxDistance=6,s.minAzimuthAngle=-Math.PI/6,s.maxAzimuthAngle=Math.PI/6,s.minPolarAngle=Math.PI/2-Math.PI/6,s.maxPolarAngle=Math.PI/2+Math.PI/6,s.enablePan=!1,a.current=s})(),m.appendChild(e.domElement);const w=new W(6316128,.9);c.add(w);const b=new I(16777215,.9);b.position.set(5,10,7),b.castShadow=!0,c.add(b);const g=new I(7829503,.5);g.position.set(-5,-5,-5),c.add(g);const v=new J(5164484,.7,80);v.position.set(0,3,3),c.add(v);const y=new Y;c.add(y),h.current=y;let E=0;const x=1e3/30,k=N=>{var _;if(P.current=requestAnimationFrame(k),N===void 0){e.render(c,r);return}N-E<x||(E=N,(_=a.current)==null||_.update(),e.render(c,r))};return k(),typeof o=="function"&&requestAnimationFrame(()=>o()),()=>{P.current&&cancelAnimationFrame(P.current),a.current&&typeof a.current.dispose=="function"&&a.current.dispose(),m.removeChild(e.domElement),e.dispose()}},[]),i.useEffect(()=>{const m=()=>{if(!f.current||!t.current||!l.current)return;const c=f.current.clientWidth,r=f.current.clientHeight;t.current.aspect=c/r,t.current.updateProjectionMatrix(),l.current.setSize(c,r)};return window.addEventListener("resize",m),()=>window.removeEventListener("resize",m)},[]),i.useEffect(()=>{if(!p||!h.current)return;u.current.forEach(e=>{var s;return(s=h.current)==null?void 0:s.remove(e)}),R.current.forEach(e=>{var s;return(s=h.current)==null?void 0:s.remove(e)}),u.current=[],R.current=[];const{landmarks:m,connections:c,jointAngles:r}=p;if(!(!m||m.length===0)){if(j.current)if(r&&(r.leftElbow!==void 0||r.rightElbow!==void 0||r.leftKnee!==void 0||r.rightKnee!==void 0||r.leftShoulder!==void 0||r.rightShoulder!==void 0)){let e='<div class="angle-title">关节角度</div><div class="angle-grid">';r.leftElbow!==void 0&&(e+=`<div class="angle-item"><span class="angle-label">左肘:</span><span class="angle-value">${r.leftElbow}°</span></div>`),r.rightElbow!==void 0&&(e+=`<div class="angle-item"><span class="angle-label">右肘:</span><span class="angle-value">${r.rightElbow}°</span></div>`),r.leftKnee!==void 0&&(e+=`<div class="angle-item"><span class="angle-label">左膝:</span><span class="angle-value">${r.leftKnee}°</span></div>`),r.rightKnee!==void 0&&(e+=`<div class="angle-item"><span class="angle-label">右膝:</span><span class="angle-value">${r.rightKnee}°</span></div>`),r.leftShoulder!==void 0&&(e+=`<div class="angle-item"><span class="angle-label">左肩:</span><span class="angle-value">${r.leftShoulder}°</span></div>`),r.rightShoulder!==void 0&&(e+=`<div class="angle-item"><span class="angle-label">右肩:</span><span class="angle-value">${r.rightShoulder}°</span></div>`),e+="</div>",j.current.style.display="block",j.current.innerHTML=e}else j.current.style.display="none",j.current.innerHTML="";m.forEach((e,s)=>{var E;if(e.visibility<.3)return;let w=.12;s===11||s===12||s===23||s===24?w=.18:(s===13||s===14||s===25||s===26)&&(w=.15);const b=new Q(w,16,16);let g=65280;s<=10?g=16724787:s===11||s===12?g=65535:s===23||s===24?g=3368703:s>=25&&s<=32?g=16750848:s>=15&&s<=22&&(g=16738047);const v=new X({color:g,shininess:100,specular:2236962,emissive:g,emissiveIntensity:.3}),y=new Z(b,v);y.position.set((e.x-.5)*10,(.5-e.y)*10,(e.z-.5)*10),v.opacity=.9+e.visibility*.1,v.transparent=!0,(E=h.current)==null||E.add(y),u.current.push(y)}),c.forEach(([e,s])=>{var x;if(e>=m.length||s>=m.length)return;const w=m[e],b=m[s];if(w.visibility<.3||b.visibility<.3)return;const g=[];g.push(new D((w.x-.5)*10,(.5-w.y)*10,(w.z-.5)*10)),g.push(new D((b.x-.5)*10,(.5-b.y)*10,(b.z-.5)*10));const v=new ee().setFromPoints(g),y=new te({color:16777215,transparent:!0,opacity:.8}),E=new se(v,y);(x=h.current)==null||x.add(E),R.current.push(E)})}},[p]),n.jsxs("div",{className:"pose-visualizer",children:[n.jsx("div",{className:"visualizer-header",children:n.jsx("h3",{children:"3D 姿态可视化"})}),n.jsx("div",{ref:f,className:"visualizer-container",children:n.jsx("div",{ref:j,className:"angle-display"})})]})};function he(){const[p,o]=i.useState(null),[f,d]=i.useState(!1),[t,l]=i.useState(!1),a=R=>{o(R)},u=i.useMemo(()=>f&&t,[f,t]);return n.jsxs("div",{className:"App",children:[n.jsxs("header",{className:"app-header",children:[n.jsx("h1",{className:"app-title",children:"MediaPipe 2.0+ 姿态识别"}),n.jsx("p",{className:"app-subtitle",children:"实时3D骨骼可视化 - 跟随你的真实姿态角度"})]}),n.jsxs("main",{className:"app-content",children:[n.jsx(ue,{onPoseDetection:a,onReady:()=>d(!0)}),n.jsx(pe,{poseData:p,onReady:()=>l(!0)})]}),!u&&n.jsx("div",{className:"app-loading-overlay",children:n.jsxs("div",{className:"app-loading-card",children:[n.jsx("div",{className:"app-loading-ring"}),n.jsx("div",{className:"app-loading-title",children:"正在准备舞台"}),n.jsx("div",{className:"app-loading-subtitle",children:"加载 MediaPipe 与 Three.js 中…"})]})}),n.jsx("footer",{className:"app-footer",children:n.jsx("p",{children:"基于 MediaPipe Tasks Vision API 构建 | 支持实时姿态角度同步"})})]})}A.createRoot(document.getElementById("root")).render(n.jsx(G.StrictMode,{children:n.jsx(he,{})}));
