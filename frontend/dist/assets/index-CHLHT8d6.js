const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./OrbitControls-C4cd0N3Z.js","./three-o_4xCI06.js"])))=>i.map(i=>d[i]);
import{r as l,a as V,R as B}from"./vendor-nf7bT_Uh.js";import{P as C,H as F}from"./mediapipe-D662JjxJ.js";import{S as G,C as H,P as U,W,a as q,A as K,D as A,b as J,G as Y,c as Q,M as X,d as Z,V as I,B as ee,L as te,e as re}from"./three-o_4xCI06.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function y(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=y(n);fetch(n.href,o)}})();var T={exports:{}},k={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var se=l,ne=Symbol.for("react.element"),ae=Symbol.for("react.fragment"),ie=Object.prototype.hasOwnProperty,oe=se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,le={key:!0,ref:!0,__self:!0,__source:!0};function $(f,r,y){var i,n={},o=null,d=null;y!==void 0&&(o=""+y),r.key!==void 0&&(o=""+r.key),r.ref!==void 0&&(d=r.ref);for(i in r)ie.call(r,i)&&!le.hasOwnProperty(i)&&(n[i]=r[i]);if(f&&f.defaultProps)for(i in r=f.defaultProps,r)n[i]===void 0&&(n[i]=r[i]);return{$$typeof:ne,type:f,key:o,ref:d,props:n,_owner:oe.current}}k.Fragment=ae;k.jsx=$;k.jsxs=$;T.exports=k;var a=T.exports,M={},D=V;M.createRoot=D.createRoot,M.hydrateRoot=D.hydrateRoot;let x=null,L=!1;const ce=async()=>{if(!(x||L)){L=!0;try{console.log("预加载 MediaPipe 模型...");const f=await C.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.9/wasm");x=await F.createFromOptions(f,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",delegate:"GPU"},runningMode:"VIDEO",numPoses:1}),console.log("MediaPipe 模型预加载完成")}catch(f){console.error("模型预加载失败:",f)}finally{L=!1}}};ce();const ue=({onPoseDetection:f})=>{const r=l.useRef(null),y=l.useRef(null),i=l.useRef(null),n=l.useRef(null),o=l.useRef(null),d=l.useRef(0),[p,P]=l.useState(!1),[v,R]=l.useState(null),[u,c]=l.useState("准备中..."),s=[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[12,14],[14,16],[15,17],[15,19],[15,21],[17,19],[16,18],[16,20],[18,20],[23,24],[23,25],[25,27],[27,29],[27,31],[24,26],[26,28],[28,30],[28,32]],t=async()=>{try{c("正在启动相机...");const[m,h]=await Promise.all([(async()=>{if(x)return c("模型已就绪，正在启动相机..."),x;for(c("正在加载 MediaPipe 模型...");L;)await new Promise(w=>setTimeout(w,100));if(x)return x;c("重新加载模型...");const g=await C.forVisionTasks("https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.9/wasm");return await F.createFromOptions(g,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/pose_landmarker/pose_landmarker_lite/float16/1/pose_landmarker_lite.task",delegate:"GPU"},runningMode:"VIDEO",numPoses:1})})(),navigator.mediaDevices.getUserMedia({video:{width:640,height:480,facingMode:"user",frameRate:{ideal:30,max:30}}})]);i.current=m,n.current=h,c("正在连接视频流..."),r.current&&(r.current.srcObject=h,r.current.onloadedmetadata=()=>{c("正在启动姿态检测..."),e(),P(!0),c("✅ 已连接")}),console.log("MediaPipe 和相机快速初始化成功")}catch(m){console.error("初始化失败:",m),R("初始化失败: "+(m instanceof Error?m.message:"未知错误"))}},e=()=>{const m=async()=>{if(i.current&&r.current&&r.current.readyState===4){const h=performance.now();if(h-d.current>=33){d.current=h;const w=i.current.detectForVideo(r.current,h);if(w.landmarks&&w.landmarks.length>0){const E={success:!0,landmarks:w.landmarks[0].map((j,_)=>({id:_,x:j.x,y:j.y,z:j.z,visibility:j.visibility||1})),connections:s};f(E)}}}o.current=requestAnimationFrame(m)};m()};return l.useEffect(()=>(t(),()=>{o.current&&cancelAnimationFrame(o.current),n.current&&n.current.getTracks().forEach(m=>m.stop()),i.current&&i.current!==x&&i.current.close()}),[]),v?a.jsx("div",{className:"camera-capture error",children:a.jsxs("div",{className:"error-message",children:[a.jsx("h3",{children:"❌ 错误"}),a.jsx("p",{children:v}),a.jsx("button",{onClick:()=>window.location.reload(),children:"刷新页面重试"})]})}):a.jsxs("div",{className:"camera-capture",children:[a.jsxs("div",{className:"camera-header",children:[a.jsx("h3",{children:"📷 相机捕获"}),a.jsx("div",{className:"status",children:p?"✅ 已连接":u})]}),a.jsxs("div",{className:"camera-container",children:[a.jsx("video",{ref:r,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-video"}),a.jsx("canvas",{ref:y,className:"camera-canvas",width:640,height:480}),!p&&a.jsxs("div",{className:"loading-overlay",children:[a.jsx("div",{className:"loading-spinner"}),a.jsx("p",{children:u})]})]})]})},de="modulepreload",me=function(f,r){return new URL(f,r).href},z={},fe=function(r,y,i){let n=Promise.resolve();if(y&&y.length>0){const d=document.getElementsByTagName("link"),p=document.querySelector("meta[property=csp-nonce]"),P=(p==null?void 0:p.nonce)||(p==null?void 0:p.getAttribute("nonce"));n=Promise.allSettled(y.map(v=>{if(v=me(v,i),v in z)return;z[v]=!0;const R=v.endsWith(".css"),u=R?'[rel="stylesheet"]':"";if(!!i)for(let t=d.length-1;t>=0;t--){const e=d[t];if(e.href===v&&(!R||e.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${u}`))return;const s=document.createElement("link");if(s.rel=R?"stylesheet":de,R||(s.as="script"),s.crossOrigin="",s.href=v,P&&s.setAttribute("nonce",P),document.head.appendChild(s),R)return new Promise((t,e)=>{s.addEventListener("load",t),s.addEventListener("error",()=>e(new Error(`Unable to preload CSS for ${v}`)))})}))}function o(d){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=d,window.dispatchEvent(p),!p.defaultPrevented)throw d}return n.then(d=>{for(const p of d||[])p.status==="rejected"&&o(p.reason);return r().catch(o)})},pe=({poseData:f})=>{const r=l.useRef(null),y=l.useRef(null),i=l.useRef(null),n=l.useRef(null),o=l.useRef(null),d=l.useRef([]),p=l.useRef([]),P=l.useRef(null),v=l.useRef(null),R=l.useRef(null);return l.useEffect(()=>{if(!r.current)return;const u=r.current,c=new G;c.background=new H(2763306),y.current=c;const s=new U(60,u.clientWidth/u.clientHeight,.1,1e3);s.position.set(0,0,5),i.current=s;const t=new W({antialias:!0,alpha:!0,powerPreference:"high-performance"});t.setSize(u.clientWidth,u.clientHeight),t.shadowMap.enabled=!0,t.shadowMap.type=q,t.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),n.current=t;let e;(async()=>{const N=(await fe(()=>import("./OrbitControls-C4cd0N3Z.js"),__vite__mapDeps([0,1]),import.meta.url)).OrbitControls;e=new N(s,t.domElement),e.enableDamping=!0,e.dampingFactor=.05,e.screenSpacePanning=!1,e.minDistance=4,e.maxDistance=6,e.minAzimuthAngle=-Math.PI/6,e.maxAzimuthAngle=Math.PI/6,e.minPolarAngle=Math.PI/2-Math.PI/6,e.maxPolarAngle=Math.PI/2+Math.PI/6,e.enablePan=!1,o.current=e})(),u.appendChild(t.domElement);const m=new K(6316128,1.2);c.add(m);const h=new A(16777215,1.2);h.position.set(5,10,7),h.castShadow=!0,c.add(h);const g=new A(7829503,.7);g.position.set(-5,-5,-5),c.add(g);const w=new J(5164484,1,100);w.position.set(0,3,3),c.add(w);const b=new Y;c.add(b),P.current=b;let E=0;const j=1e3/30,_=S=>{var O;if(v.current=requestAnimationFrame(_),S===void 0){t.render(c,s);return}S-E<j||(E=S,(O=o.current)==null||O.update(),t.render(c,s))};return _(),()=>{v.current&&cancelAnimationFrame(v.current),o.current&&typeof o.current.dispose=="function"&&o.current.dispose(),u.removeChild(t.domElement),t.dispose()}},[]),l.useEffect(()=>{const u=()=>{if(!r.current||!i.current||!n.current)return;const c=r.current.clientWidth,s=r.current.clientHeight;i.current.aspect=c/s,i.current.updateProjectionMatrix(),n.current.setSize(c,s)};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]),l.useEffect(()=>{if(!f||!P.current)return;d.current.forEach(t=>{var e;return(e=P.current)==null?void 0:e.remove(t)}),p.current.forEach(t=>{var e;return(e=P.current)==null?void 0:e.remove(t)}),d.current=[],p.current=[];const{landmarks:u,connections:c,jointAngles:s}=f;if(!(!u||u.length===0)){if(R.current&&s){let t='<div class="angle-title">关节角度</div><div class="angle-grid">';s.leftElbow&&(t+=`<div class="angle-item"><span class="angle-label">左肘:</span><span class="angle-value">${s.leftElbow}°</span></div>`),s.rightElbow&&(t+=`<div class="angle-item"><span class="angle-label">右肘:</span><span class="angle-value">${s.rightElbow}°</span></div>`),s.leftKnee&&(t+=`<div class="angle-item"><span class="angle-label">左膝:</span><span class="angle-value">${s.leftKnee}°</span></div>`),s.rightKnee&&(t+=`<div class="angle-item"><span class="angle-label">右膝:</span><span class="angle-value">${s.rightKnee}°</span></div>`),s.leftShoulder&&(t+=`<div class="angle-item"><span class="angle-label">左肩:</span><span class="angle-value">${s.leftShoulder}°</span></div>`),s.rightShoulder&&(t+=`<div class="angle-item"><span class="angle-label">右肩:</span><span class="angle-value">${s.rightShoulder}°</span></div>`),t+="</div>",R.current.innerHTML=t}u.forEach((t,e)=>{var E;if(t.visibility<.3)return;let m=.12;e===11||e===12||e===23||e===24?m=.18:(e===13||e===14||e===25||e===26)&&(m=.15);const h=new Q(m,24,24);let g=65280;e<=10?g=16724787:e===11||e===12?g=65535:e===23||e===24?g=3368703:e>=25&&e<=32?g=16750848:e>=15&&e<=22&&(g=16738047);const w=new X({color:g,shininess:100,specular:2236962,emissive:g,emissiveIntensity:.3}),b=new Z(h,w);b.position.set((t.x-.5)*10,(.5-t.y)*10,(t.z-.5)*10),w.opacity=.9+t.visibility*.1,w.transparent=!0,(E=P.current)==null||E.add(b),d.current.push(b)}),c.forEach(([t,e])=>{var j;if(t>=u.length||e>=u.length)return;const m=u[t],h=u[e];if(m.visibility<.3||h.visibility<.3)return;const g=[];g.push(new I((m.x-.5)*10,(.5-m.y)*10,(m.z-.5)*10)),g.push(new I((h.x-.5)*10,(.5-h.y)*10,(h.z-.5)*10));const w=new ee().setFromPoints(g),b=new te({color:16777215,linewidth:5,transparent:!0,opacity:.9}),E=new re(w,b);(j=P.current)==null||j.add(E),p.current.push(E)})}},[f]),a.jsxs("div",{className:"pose-visualizer",children:[a.jsx("div",{className:"visualizer-header",children:a.jsx("h3",{children:"3D 姿态可视化"})}),a.jsx("div",{ref:r,className:"visualizer-container"}),a.jsx("div",{ref:R,className:"angle-display"})]})};function he(){const[f,r]=l.useState(null),y=i=>{r(i)};return a.jsxs("div",{className:"App",children:[a.jsxs("header",{className:"app-header",children:[a.jsx("h1",{className:"app-title",children:"MediaPipe 2.0+ 姿态识别"}),a.jsx("p",{className:"app-subtitle",children:"实时3D骨骼可视化 - 跟随你的真实姿态角度"})]}),a.jsxs("main",{className:"app-content",children:[a.jsx(ue,{onPoseDetection:y}),a.jsx(pe,{poseData:f})]}),a.jsx("footer",{className:"app-footer",children:a.jsx("p",{children:"基于 MediaPipe Tasks Vision API 构建 | 支持实时姿态角度同步"})})]})}M.createRoot(document.getElementById("root")).render(a.jsx(B.StrictMode,{children:a.jsx(he,{})}));
